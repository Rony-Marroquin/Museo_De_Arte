CREATE DATABASE Arte_Museo
use Arte_Museo

CREATE TABLE PIEZAS
(
CODIGO_PIEZA CHAR(5) PRIMARY KEY NOT NULL,
NOMBRE VARCHAR(30),

)



CREATE TABLE Exposicion
(
CODIGO_PIEZA CHAR(5)  NOT NULL,
ID_PINTOR CHAR(5),
PRECIO NUMERIC(10,2),

)

CREATE TABLE PINTORES
(
ID_PINTORES CHAR(5) PRIMARY KEY NOT NULL,
Nombre varchar(30),

)


ALTER TABLE EXPOSICION 
ADD CONSTRAINT FK_ID_PINTOR
FOREIGN KEY (ID_PINTOR) REFERENCES PINTORES(ID_PINTORES)

ALTER TABLE EXPOSICION 
ADD CONSTRAINT FK_CODIGO_PIEZA
FOREIGN KEY (CODIGO_PIEZA) REFERENCES PIEZAS(CODIGO_PIEZA)


INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA001','LA ULTIMA CENA')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA002','LA GIOCONDA')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA003','LA NOCHE ESTRELLADA')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA004','LAS TRES GRACIAS')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA005','EL GRITO')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA006','EL GUERNICA')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA007','LA CREACION DE ADAN')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA008','LOS GIRASOLES')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA009','LA TENTACION DE SAN ANTONIO')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA010','LOS FUSILAMIENTOS DEL 3 MAYO')

INSERT INTO PIEZAS(CODIGO_PIEZA,NOMBRE)
VALUES('PA011','EL TALLER DE BD')


SELECT * FROM PIEZAS 

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA001','GOYA')

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA002','DALI')

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA003','VAN GOGH')

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA004','MIGUEL ANGEL')

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA005','PABLO PICASSO')

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA006','RUBENS')

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA007','DA VINCI')

INSERT INTO PINTORES(ID_PINTORES,Nombre)
VALUES('NA008','KEVIN')

SELECT * FROM PINTORES


SELECT * FROM Exposicion

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA001','NA007',12000.80)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA002','NA007',13500.70)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA003','NA003',18000.13)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA004','NA006',25000.80)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA005','NA003',30879.00)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA006','NA005',25000.25)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA007','NA004',50000.75)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA008','NA003',10000.80)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA009','NA002',13000.10)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA010','NA001',9000.05)

INSERT INTO Exposicion(CODIGO_PIEZA,ID_PINTOR,PRECIO)
VALUES('PA011','NA008',NULL)


-----ALIAS---
--- TABLA PIEZA = T1
----TABLA EXPOSICION =T2
----TABLA PINTORES= T3

--- 1. Obtener los nombres de todas las piezas de arte-----

SELECT  T1.NOMBRE  AS 'NOMBRES DE TODAS LAS PIEZAS'
FROM Piezas AS T1
JOIN Exposicion AS T2 ON T1.CODIGO_PIEZA = T2.CODIGO_PIEZA


--- 2. Obtener todos los datos de todos los pintores---

SELECT T3.ID_PINTORES,T3.Nombre 
FROM PINTORES AS T3
JOIN Exposicion AS T2 ON T3.ID_PINTORES=T2.ID_PINTOR 



--- 3. Obtener el precio medio de los cuadros expuestos (dos decimales)---


SELECT CAST(AVG(T2.PRECIO) AS DECIMAL (10,2)) AS 'PRECIO MEDIO DE TODAS LA PIEZA EXPUESTAS'
FROM Exposicion AS T2
JOIN PIEZAS AS T1 ON T1.CODIGO_PIEZA=T1.CODIGO_PIEZA
JOIN PINTORES AS T3 ON T3.ID_PINTORES = T2.ID_PINTOR



----4. Obtener el nombre del pintor que hizo la pieza “El grito”---

SELECT T3.Nombre AS 'NOMBRE DEL PINTOR DEL GRITO'
FROM Piezas AS T1
JOIN Exposicion AS T2 ON T1.CODIGO_PIEZA = T2.CODIGO_PIEZA
JOIN Pintores AS T3 ON T2.ID_PINTOR = T3.ID_PINTORES
WHERE T1.NOMBRE = 'EL GRITO';

---5. Obtener los nombres de las piezas expuestas del pintor Van Gogh.----

SELECT T1.NOMBRE AS 'PIESAS EXPUESTA DEL PINTOR VAN GOGH'
FROM PIEZAS AS T1
JOIN Exposicion AS T2 ON  T1.CODIGO_PIEZA = T2.CODIGO_PIEZA
JOIN PINTORES AS T3 ON  T2.ID_PINTOR= T3.ID_PINTORES
WHERE T3.Nombre ='VAN GOGH'

---- 6. Obtener el nombre de la pieza más cara de toda la exposición.

SELECT T1.NOMBRE AS 'PIEZA MAS CARA DE LA EXPOSICION '
FROM PIEZAS AS T1
JOIN Exposicion AS T2 ON T2.CODIGO_PIEZA= T1.CODIGO_PIEZA
WHERE  T2.PRECIO = (SELECT MAX(PRECIO) FROM Exposicion)



------7. Obtener el nombre de los 3 pintores que suministran las piezas más caras, indicando el
---------nombre de la pieza y el precio de la obra de arte

SELECT TOP 3 T3.NOMBRE 'NOMBRE DE PINTORES' ,T1.NOMBRE AS 'NOMBRE DE LA PIEZA', T2.PRECIO AS 'PRECIO DE LA PIEZA'
FROM PINTORES AS T3 
JOIN Exposicion AS T2 ON T2.ID_PINTOR =T3.ID_PINTORES
JOIN PIEZAS AS T1 ON T1.CODIGO_PIEZA=T2.CODIGO_PIEZA
ORDER BY T2.PRECIO DESC


----8. Nombre de los pintores en exposición y su cantidad de cuadros respectivos. 

SELECT T3.NOMBRE AS 'NOMBRE DE LOS PINTORES', COUNT(T2.CODIGO_PIEZA) AS 'CANTIDAD DE CUADROS'
FROM PINTORES AS T3
JOIN Exposicion AS T2 ON T2.ID_PINTOR = T3.ID_PINTORES
GROUP BY T3.NOMBRE


---9. Nombre de los cuadros de los pintores Van Gogh y Da Vinci.

SELECT T1.NOMBRE 'NOMBRE DE LOS CUADROS EXPUESTOS DE  VAN GOGH Y DA VINCI'
FROM PIEZAS AS T1 
JOIN Exposicion AS T2 ON T2.CODIGO_PIEZA= T1.CODIGO_PIEZA
JOIN PINTORES AS T3 ON T3.ID_PINTORES= T2.ID_PINTOR
WHERE T3.Nombre IN ('DA VINCI', 'VAN GOGH')

----10. Aumentar los precios de las piezas en una unidad.

UPDATE Exposicion
SET PRECIO = PRECIO + 1

SELECT T2.PRECIO AS 'PRECIOS AUMENTADO UNA UNIDAD'
FROM Exposicion AS T2

----11. Sustituir los datos del pintor Van Gogh por el nombre “Vincent Van Gogh”.


UPDATE PINTORES
SET NOMBRE = 'VINCENT VAN GOGH'
WHERE NOMBRE = 'VAN GOGH'

SELECT T3.Nombre FROM PINTORES AS T3


----12. Sustituir los datos del pintor Da Vinci por el nombre “Leonardo Da Vinci”

UPDATE PINTORES
SET Nombre = 'LEONARDO DA VINCI'
WHERE Nombre='DA VINCI '

SELECT T3.Nombre FROM PINTORES AS T3

--13. Hacer constar en la base de datos que el artista Kevin ya no va a exponer ningún cuadro
---en nuestro Museo. (Aunque el pintor en si va a seguir en nuestra base de datos).


UPDATE Exposicion
SET CODIGO_PIEZA = NULL
WHERE ID_PINTOR = (SELECT ID_PINTORES FROM PINTORES WHERE NOMBRE = 'Kevin')


----14. Eliminar el documento del pintor con menos cantidad de obras expuestas.

SELECT T3.NOMBRE AS 'NOMBRE DE LOS PINTORES', COUNT(T2.CODIGO_PIEZA) AS 'CANTIDAD DE CUADROS'
FROM PINTORES AS T3
JOIN Exposicion AS T2 ON T2.ID_PINTOR = T3.ID_PINTORES
GROUP BY T3.NOMBRE

DELETE FROM PINTORES
WHERE Nombre = 'RUBENS'